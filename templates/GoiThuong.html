<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_title }}</title>
    <meta name="description" content="{{ site_description }}">
    <meta name="keywords" content="qu·∫£n l√Ω bi·ªÉu m·∫´u, bi·ªÉu m·∫´u t·ª± ƒë·ªông, AI, nh·∫≠p li·ªáu, t·ª± ƒë·ªông h√≥a">
    <meta property="og:title" content="Qu·∫£n l√Ω Bi·ªÉu m·∫´u - {{ site_title }}">
    <meta property="og:description" content="{{ site_description }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/dashboard">
    <meta property="og:image" content="{{ og_image }}">
    <link rel="icon" type="image/png" href="{{ site_logo }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family={{ font_family|replace(' ', '+') }}:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='js/responsive.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme-config.js') }}"></script>
  <style>
  * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', sans-serif;
}

body {
  background-color: #f4f4f4;
  display: flex;
  justify-content: center;
  padding: 40px 20px;
}

.container {
  display: flex;
  width: 100%;
  max-width: 1100px;
  box-shadow: 0 0 12px rgba(0,0,0,0.1);
  border-radius: 10px;
  overflow: hidden;
}

.left-panel {
  background-color: #1a1a1a;
  color: white;
  padding: 40px 30px;
  width: 50%;
}

.left-panel h2 {
  font-size: 20px;
  color: #999;
}

.left-panel h1 {
  font-size: 42px;
  margin: 10px 0 30px;
}

.left-panel h1 span {
  font-size: 16px;
  color: #aaa;
}

.plan-box {
  background-color: #2a2a2a;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 30px;
}

.plan-header {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.plan-header img {
  width: 40px;
  height: 40px;
}

.annual-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 10px;
  font-size: 14px;
}

.annual-option input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 10px;
}

.discount-label {
  background-color: #00d084;
  color: black;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: bold;
  margin-right: 4px;
}

.totals {
  margin-top: 20px;
  border-top: 1px solid #444;
  padding-top: 20px;
}

.subtotal,
.total-due {
  display: flex;
  justify-content: space-between;
  margin: 15px 0;
  font-size: 16px;
  font-weight: bold;
}

.promo-code-section {
  margin: 15px 0;
}

#promoInput {
  display: none;
  width: 100%;
  margin-top: 10px;
  padding: 8px;
  border-radius: 4px;
  border: none;
  font-size: 14px;
}

#togglePromo {
  padding: 8px 12px;
  border: none;
  background-color: #333;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}

/* RIGHT PANEL */
.right-panel {
  background-color: #fff;
  color: #333;
  padding: 40px 30px;
  width: 50%;
}

.right-panel form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.right-panel input[type="email"] {
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

.payment-methods {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.payment-methods label {
  display: flex;
  align-items: center;
  justify-content: space-between; /* N·∫øu mu·ªën label v√† n·ªôi dung c√°ch ƒë·ªÅu */
  gap: 10px;
  padding: 10px;
  border: 1px solid #161313;
  border-radius: 6px;
  cursor: pointer;
}

/* CƒÉn gi·ªØa ri√™ng radio button n·∫øu c·∫ßn */
.payment-methods input[type="radio"] {
  transform: scale(1.2);
  margin-left: 0;   /* Kh√¥ng c·∫ßn cƒÉn tr√°i */
  align-self: center;  /* ƒê·∫£m b·∫£o n·∫±m gi·ªØa theo chi·ªÅu d·ªçc */
}

.subscribe-btn {
  background-color: #2979ff;
  color: white;
  border: none;
  padding: 14px;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
}

.terms {
  font-size: 13px;
  color: #666;
  line-height: 1.4;
}

.right-panel small {
  font-size: 12px;
  color: #999;
  margin-top: 10px;
}

.right-panel a {
  color: #666;
  text-decoration: none;
  margin: 0 5px;
}

.right-panel a:hover {
  text-decoration: underline;
}

/* ‚úÖ Responsive */
@media (max-width: 900px) {
  .container {
    flex-direction: column;
    max-width: 95%;
  }

  .left-panel,
  .right-panel {
    width: 100%;
  }
}
.card-info {
  display: none;
  margin-top: 10px;
  font-size: 14px;
}

.card-info label {
  margin: 10px 0 5px;
  font-weight: bold;
}

.card-row {
  display: flex;
  align-items: center;
  gap: 5px;
}

.card-row input {
  flex: 1;
  padding: 10px;
}

.card-row img {
  height: 20px;
}

.card-subrow {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.card-subrow input {
  flex: 1;
  padding: 10px;
}

.card-info input,
.card-info select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

/* MoMo Payment Styles */
.momo-info {
  display: none;
  margin-top: 15px;
  padding: 15px;
  background-color: #f9f9f9;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.momo-info img {
  width: 100%;
  max-width: 200px;
  display: block;
  margin: 10px auto;
}

.momo-steps {
  margin-top: 15px;
}

.momo-steps ol {
  padding-left: 20px;
  margin-top: 10px;
}

.momo-steps li {
  margin-bottom: 8px;
  line-height: 1.4;
}

.momo-qr-code {
  text-align: center;
  margin: 15px 0;
  padding: 10px;
  background: white;
  border-radius: 8px;
  border: 1px dashed #ccc;
}

.momo-qr-code img {
  width: 150px;
  height: 150px;
  margin-bottom: 10px;
}

.momo-phone {
  display: flex;
  align-items: center;
  margin-top: 15px;
}

.momo-phone input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin-right: 10px;
}

.momo-phone button {
  padding: 10px 15px;
  background-color: #af1f6b;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.momo-logo {
  color: #af1f6b;
  font-weight: bold;
  font-size: 18px;
}
</style>
  
</head>
<body>
    <div class="container">
      <!-- LEFT SECTION -->
      <div class="left-panel">
        <h2>ƒêƒÉng k√Ω Pro Plan</h2>
        <h1>49,00 US$ <span>/ m·ªói th√°ng</span></h1>
  
        <div class="plan-box">
          <div class="plan-header">
            <img src="/static/images/ChatGPT_Image_12_38_56_26_thg_4_2025.png" alt="Fillout Logo">

            <div>
              <strong>Pro Plan</strong><br>
              <small>See auto fill for details of what is included on the Pro plan.<br>
                Thanh to√°n h√†ng th√°ng</small>
            </div>
          </div>
          <div class="annual-option">
            <label>
              <input type="checkbox" id="toggle-annual">
              <span class="discount-label">Ti·∫øt ki·ªám 108 US$</span>
              <span>v·ªõi thanh to√°n h√†ng nƒÉm</span>
            </label>
            <div class="price-annual">480,00 US$/nƒÉm</div>
          </div>
        </div>
  
        <div class="totals">
          <div class="subtotal">T·ªïng ph·ª• <span>49,00 US$</span></div>
  
          <div class="promo-code-section">
            <button id="togglePromo" type="button">Th√™m m√£ khuy·∫øn m√£i</button>
            <input type="text" id="promoInput" placeholder="Nh·∫≠p m√£ khuy·∫øn m√£i">
          </div>
  
          <div class="total-due">
            T·ªïng ti·ªÅn ph·∫£i tr·∫£ h√¥m nay <span>49,00 US$</span>
          </div>
        </div>
      </div>
  
      <!-- RIGHT SECTION -->
      <div class="right-panel">
        <form id="payment-form" method="post" action="/payment/momo/create">
          <input type="hidden" id="subscription_type" name="subscription_type" value="standard">
          
          <label for="email">Th√¥ng tin li√™n h·ªá</label>
          <input type="email" id="email" name="email" placeholder="Email" required value="{{ current_user.email if current_user.is_authenticated else '' }}">
  
          <label>Ph∆∞∆°ng th·ª©c thanh to√°n</label>
          <div class="payment-methods">
            <label><input type="radio" name="payment_method" value="card" checked> üí≥ Th·∫ª</label>
            <!-- Di chuy·ªÉn card-details RA NGO√ÄI label -->
          <div id="card-details" class="card-info">
            <label>Th√¥ng tin th·∫ª</label>
            <div class="card-row">
              <input type="text" placeholder="1234 1234 1234 1234">
              <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" alt="Visa" title="Visa">
              <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" title="Mastercard">
              <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg" alt="Amex" title="Amex">
              <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Discover_Card_logo.svg" alt="Discover" title="Discover">
            </div>
  
            <div class="card-subrow">
              <input type="text" placeholder="MM / YY">
              <input type="text" placeholder="CVC">
            </div>
  
            <label>T√™n ch·ªß th·∫ª</label>
            <input type="text" placeholder="H·ªç v√† t√™n">
  
            <label>Qu·ªëc gia ho·∫∑c khu v·ª±c</label>
            <select>
              <option selected>Vi·ªát Nam</option>
              <option>Hoa K·ª≥</option>
              <option>Nh·∫≠t B·∫£n</option>
              <option>H√†n Qu·ªëc</option>
              <option>Kh√°c</option>
            </select>
          </div>
            <label><input type="radio" name="payment_method" value="momo"> <span class="momo-logo">MoMo</span></label>
          </div>
          
          <!-- MoMo Payment Section -->
          <div id="momo-details" class="momo-info">
            <h3>Thanh to√°n qua MoMo</h3>
            <img src="https://developers.momo.vn/v3/vi/img/logo.png" alt="MoMo Logo">
            
            <div class="momo-steps">
              <p>Vui l√≤ng th·ª±c hi·ªán theo c√°c b∆∞·ªõc sau:</p>
              <ol>
                <li>M·ªü ·ª©ng d·ª•ng MoMo tr√™n ƒëi·ªán tho·∫°i c·ªßa b·∫°n</li>
                <li>Ch·ªçn t√≠nh nƒÉng "Qu√©t m√£ QR"</li>
                <li>Qu√©t m√£ QR b√™n d∆∞·ªõi ƒë·ªÉ thanh to√°n</li>
                <li>X√°c nh·∫≠n thanh to√°n tr√™n ·ª©ng d·ª•ng MoMo</li>
              </ol>
            </div>
            
            <div class="momo-qr-code">
              <p>Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ nh·∫≠n link thanh to√°n</p>
            </div>
            
            <div class="momo-phone">
              <input type="tel" id="phone_number" name="phone_number" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i MoMo" required>
              <button type="button" id="momo-request-btn">G·ª≠i y√™u c·∫ßu</button>
            </div>
          </div>
  
          <button type="submit" id="submit-btn" class="subscribe-btn">ƒêƒÉng k√Ω</button>
  
          <p class="terms">
            Khi x√°c nh·∫≠n g√≥i ƒëƒÉng k√Ω, b·∫°n ƒë·ªìng √Ω v·ªõi c√°c ƒëi·ªÅu kho·∫£n d·ªãch v·ª• c·ªßa ch√∫ng t√¥i. B·∫°n c√≥ th·ªÉ h·ªßy ƒëƒÉng k√Ω b·∫•t c·ª© l√∫c n√†o.
          </p>
          <small>Thanh to√°n an to√†n qua <strong>MoMo</strong><br>
            <a href="#">ƒêi·ªÅu kho·∫£n</a> ¬∑ <a href="#">Quy·ªÅn ri√™ng t∆∞</a></small>
            
          <!-- Th√¥ng b√°o k·∫øt qu·∫£ thanh to√°n -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}" style="margin-top: 20px; padding: 10px; border-radius: 5px; {% if category == 'success' %}background-color: #d4edda; color: #155724;{% else %}background-color: #f8d7da; color: #721c24;{% endif %}">
                  {{ message }}
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}
        </form>
      </div>
    </div>
  
    <script>
      // Toggle m√£ khuy·∫øn m√£i
      document.getElementById("togglePromo").addEventListener("click", function () {
        const promoInput = document.getElementById("promoInput");
        promoInput.style.display = promoInput.style.display === "block" ? "none" : "block";
      });
  
      // Toggle payment methods
      const cardDetails = document.getElementById("card-details");
      const momoDetails = document.getElementById("momo-details");
      const paymentRadios = document.querySelectorAll('input[name="payment_method"]');
      const paymentForm = document.getElementById("payment-form");
      const submitBtn = document.getElementById("submit-btn");
      const momoRequestBtn = document.getElementById("momo-request-btn");
  
      function updatePaymentForm() {
        const selected = document.querySelector('input[name="payment_method"]:checked');
        
        // ·∫®n t·∫•t c·∫£ c√°c form thanh to√°n
        cardDetails.style.display = "none";
        momoDetails.style.display = "none";
        
        // Hi·ªÉn th·ªã form thanh to√°n ƒë∆∞·ª£c ch·ªçn
        if (selected.value === "card") {
          cardDetails.style.display = "block";
          // C·∫≠p nh·∫≠t action c·ªßa form
          paymentForm.action = "/payment/card/create"; // Gi·∫£ s·ª≠ c√≥ endpoint n√†y
        } else if (selected.value === "momo") {
          momoDetails.style.display = "block";
          // C·∫≠p nh·∫≠t action c·ªßa form
          paymentForm.action = "/payment/momo/create";
        }
      }
  
      paymentRadios.forEach(radio => {
        radio.addEventListener("change", updatePaymentForm);
      });
  
      // Set initial visibility
      updatePaymentForm();
      
      // X·ª≠ l√Ω y√™u c·∫ßu thanh to√°n MoMo qua API
            // X·ª≠ l√Ω y√™u c·∫ßu thanh to√°n MoMo qua API
        momoRequestBtn.addEventListener("click", function(e) {
          e.preventDefault();
          
          const phoneNumber = document.getElementById("phone_number").value;
          const subscriptionType = document.getElementById("subscription_type").value;
          
          if (!phoneNumber || phoneNumber.length < 10) {
            alert("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i MoMo h·ª£p l·ªá");
            return;
          }
          
          // Hi·ªÉn th·ªã tr·∫°ng th√°i ƒëang x·ª≠ l√Ω
          momoRequestBtn.disabled = true;
          momoRequestBtn.textContent = "ƒêang x·ª≠ l√Ω...";
          
          // G·ª≠i y√™u c·∫ßu ƒë·∫øn API
          fetch('/payment/momo/request', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              phone_number: phoneNumber,
              subscription_type: subscriptionType
            })
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('L·ªói k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. M√£ l·ªói: ' + response.status);
            }
            return response.json();
          })
          .then(data => {
            momoRequestBtn.disabled = false;
            momoRequestBtn.textContent = "G·ª≠i y√™u c·∫ßu";
            
            if (data.success) {
              // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang thanh to√°n MoMo
              window.location.href = data.pay_url;
            } else {
              alert("L·ªói: " + data.message);
            }
          })
          .catch(error => {
            momoRequestBtn.disabled = false;
            momoRequestBtn.textContent = "G·ª≠i y√™u c·∫ßu";
            console.error('Error:', error);
            alert("ƒê√£ x·∫£y ra l·ªói: " + error.message);
          });
        });
      
      // X·ª≠ l√Ω submit form
      paymentForm.addEventListener("submit", function(e) {
        const selectedPayment = document.querySelector('input[name="payment_method"]:checked').value;
        
        // N·∫øu ch·ªçn MoMo, s·ª≠ d·ª•ng API thay v√¨ submit form
        if (selectedPayment === "momo") {
          e.preventDefault();
          momoRequestBtn.click();
        }
        // N·∫øu l√† ph∆∞∆°ng th·ª©c kh√°c, form s·∫Ω submit b√¨nh th∆∞·ªùng
      });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          const plans = {
            free: { price: 0, name: "G√≥i Mi·ªÖn Ph√≠", type: "free" },
            pro: { price: 99000, name: "G√≥i Th∆∞·ªùng", type: "standard" },
            vip: { price: 199000, name: "G√≥i VIP", type: "vip" }
          };
      
          const params = new URLSearchParams(window.location.search);
          const selectedPlanKey = params.get("plan") || "pro"; // fallback m·∫∑c ƒë·ªãnh: g√≥i Th∆∞·ªùng
          const plan = plans[selectedPlanKey];
      
          // C·∫≠p nh·∫≠t UI
          if (plan) {
            // ƒê·ªïi t√™n g√≥i
            document.querySelector(".plan-header strong").textContent = plan.name;
      
            // ƒê·ªïi gi√°
            document.querySelector(".left-panel h1").innerHTML = `${(plan.price / 1000).toFixed(3).replace('.', ',')} VNƒê <span>/ m·ªói th√°ng</span>`;
            document.querySelector(".subtotal span").textContent = `${(plan.price / 1000).toFixed(3).replace('.', ',')} VNƒê`;
            document.querySelector(".total-due span").textContent = `${(plan.price / 1000).toFixed(3).replace('.', ',')} VNƒê`;
            
            // C·∫≠p nh·∫≠t lo·∫°i g√≥i ƒëƒÉng k√Ω trong form
            document.getElementById("subscription_type").value = plan.type;
      
            // ·∫®n kh·ªëi thanh to√°n n·∫øu l√† mi·ªÖn ph√≠
            if (plan.price === 0) {
              document.querySelector(".right-panel form").style.display = "none";
              const msg = document.createElement('p');
              msg.style.marginTop = '30px';
              msg.style.fontWeight = 'bold';
              msg.style.color = 'green';
              msg.textContent = 'G√≥i mi·ªÖn ph√≠ kh√¥ng y√™u c·∫ßu thanh to√°n. B·∫°n ƒë√£ c√≥ th·ªÉ s·ª≠ d·ª•ng ngay.';
              document.querySelector(".right-panel").appendChild(msg);
            }
          }
          
          // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p
          const emailInput = document.getElementById("email");
          if (!emailInput.value) {
            const loginMsg = document.createElement('div');
            loginMsg.className = 'alert alert-warning';
            loginMsg.style.marginTop = '10px';
            loginMsg.style.padding = '10px';
            loginMsg.style.borderRadius = '5px';
            loginMsg.style.backgroundColor = '#fff3cd';
            loginMsg.style.color = '#856404';
            loginMsg.innerHTML = 'B·∫°n c·∫ßn <a href="/login?redirect=/GoiThuong.html?plan=' + selectedPlanKey + '" style="font-weight: bold;">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ ti·∫øp t·ª•c thanh to√°n.';
            
            const form = document.querySelector(".right-panel form");
            form.insertBefore(loginMsg, form.firstChild);
            
            // Disable n√∫t thanh to√°n n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
            document.getElementById("submit-btn").disabled = true;
            document.getElementById("momo-request-btn").disabled = true;
          }
        });
      </script>
  </body>
  </html>